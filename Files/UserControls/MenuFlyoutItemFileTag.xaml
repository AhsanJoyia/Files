<MenuFlyoutItem
    x:Class="Files.UserControls.MenuFlyoutItemFileTag"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Files.UserControls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    d:DesignHeight="300"
    d:DesignWidth="400">

    <MenuFlyoutItem.Icon>
        <FontIcon FontFamily="{StaticResource FluentUIGlyphs}"
                  Glyph="&#xEBAA;" />
    </MenuFlyoutItem.Icon>
    <MenuFlyoutItem.Style>
        <Style BasedOn="{StaticResource MenuFlyoutItemRevealStyle}"
               TargetType="MenuFlyoutItem">
            <Setter Property="Padding"
                    Value="11,0,11,0" />
            <Setter Property="FontSize"
                    Value="{ThemeResource ControlContentThemeFontSize}" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="local:MenuFlyoutItemFileTag">
                        <Grid x:Name="LayoutRoot"
                              Padding="{TemplateBinding Padding}"
                              Background="{TemplateBinding Background}"
                              BorderBrush="{TemplateBinding BorderBrush}"
                              BorderThickness="{TemplateBinding BorderThickness}"
                              CornerRadius="{TemplateBinding CornerRadius}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Viewbox x:Name="IconRoot"
                                     Width="16"
                                     Height="16"
                                     HorizontalAlignment="Left"
                                     VerticalAlignment="Center"
                                     Visibility="Collapsed">
                                <ContentPresenter x:Name="IconContent"
                                                  Content="{TemplateBinding Icon}" />
                            </Viewbox>
                            <ListBox x:Name="TagList"
                                     HorizontalAlignment="Left"
                                     Background="Transparent"
                                     MaxWidth="152"
                                     SelectionMode="Single"
                                     ItemsSource="{TemplateBinding ItemsSource}"
                                     SelectedItem="{Binding SelectedItem, Mode=TwoWay, RelativeSource={RelativeSource Mode=TemplatedParent}}"
                                     ScrollViewer.VerticalScrollBarVisibility="Disabled"
                                     ScrollViewer.VerticalScrollMode="Disabled"
                                     ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                                     ScrollViewer.HorizontalScrollMode="Auto">
                                <ListBox.ItemContainerStyle>
                                    <Style TargetType="ListBoxItem">
                                        <Setter Property="Padding"
                                                Value="9" />
                                    </Style>
                                </ListBox.ItemContainerStyle>
                                <ListBox.ItemTemplate>
                                    <DataTemplate x:DataType="local:FileTag">
                                        <Ellipse Stroke="Black"
                                                 Fill="{x:Bind Color}"
                                                 Width="12"
                                                 Height="12" />
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                                <ListBox.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <ItemsStackPanel Orientation="Horizontal" />
                                    </ItemsPanelTemplate>
                                </ListBox.ItemsPanel>
                            </ListBox>

                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup x:Name="CommonStates">
                                    <VisualState x:Name="Normal">

                                        <Storyboard>
                                            <PointerUpThemeAnimation Storyboard.TargetName="LayoutRoot" />
                                        </Storyboard>
                                    </VisualState>

                                    <VisualState x:Name="PointerOver">
                                        <VisualState.Setters>
                                            <Setter Target="LayoutRoot.(RevealBrush.State)"
                                                    Value="PointerOver" />
                                            <Setter Target="LayoutRoot.Background"
                                                    Value="{ThemeResource MenuFlyoutItemRevealBackgroundPointerOver}" />
                                            <Setter Target="LayoutRoot.BorderBrush"
                                                    Value="{ThemeResource MenuFlyoutItemRevealBorderBrushPointerOver}" />
                                            <Setter Target="IconContent.Foreground"
                                                    Value="{ThemeResource MenuFlyoutItemForegroundPointerOver}" />
                                        </VisualState.Setters>

                                        <Storyboard>
                                            <PointerUpThemeAnimation Storyboard.TargetName="LayoutRoot" />
                                        </Storyboard>
                                    </VisualState>

                                    <VisualState x:Name="Pressed">
                                        <VisualState.Setters>
                                            <Setter Target="LayoutRoot.(RevealBrush.State)"
                                                    Value="Pressed" />
                                            <Setter Target="LayoutRoot.Background"
                                                    Value="{ThemeResource MenuFlyoutItemRevealBackgroundPressed}" />
                                            <Setter Target="LayoutRoot.BorderBrush"
                                                    Value="{ThemeResource MenuFlyoutItemRevealBorderBrushPressed}" />
                                            <Setter Target="IconContent.Foreground"
                                                    Value="{ThemeResource MenuFlyoutItemForegroundPressed}" />
                                        </VisualState.Setters>

                                        <Storyboard>
                                            <PointerDownThemeAnimation Storyboard.TargetName="LayoutRoot" />
                                        </Storyboard>
                                    </VisualState>

                                    <VisualState x:Name="Disabled">
                                        <VisualState.Setters>
                                            <Setter Target="LayoutRoot.Background"
                                                    Value="{ThemeResource MenuFlyoutItemRevealBackgroundDisabled}" />
                                            <Setter Target="LayoutRoot.BorderBrush"
                                                    Value="{ThemeResource MenuFlyoutItemRevealBorderBrushDisabled}" />
                                            <Setter Target="IconContent.Foreground"
                                                    Value="{ThemeResource MenuFlyoutItemForegroundDisabled}" />
                                        </VisualState.Setters>
                                    </VisualState>
                                </VisualStateGroup>
                                <VisualStateGroup x:Name="CheckPlaceholderStates">
                                    <VisualState x:Name="NoPlaceholder" />
                                    <VisualState x:Name="CheckPlaceholder">
                                        <VisualState.Setters>
                                            <Setter Target="TagList.Margin"
                                                    Value="{ThemeResource MenuFlyoutItemPlaceholderThemeThickness}" />
                                        </VisualState.Setters>
                                    </VisualState>
                                    <VisualState x:Name="IconPlaceholder">
                                        <VisualState.Setters>
                                            <Setter Target="TagList.Margin"
                                                    Value="{ThemeResource MenuFlyoutItemPlaceholderThemeThickness}" />
                                            <Setter Target="IconRoot.Visibility"
                                                    Value="Visible" />
                                        </VisualState.Setters>
                                    </VisualState>
                                    <VisualState x:Name="CheckAndIconPlaceholder">
                                        <VisualState.Setters>
                                            <Setter Target="TagList.Margin"
                                                    Value="{ThemeResource MenuFlyoutItemDoublePlaceholderThemeThickness}" />
                                            <Setter Target="IconRoot.Margin"
                                                    Value="{ThemeResource MenuFlyoutItemPlaceholderThemeThickness}" />
                                            <Setter Target="IconRoot.Visibility"
                                                    Value="Visible" />
                                        </VisualState.Setters>
                                    </VisualState>
                                </VisualStateGroup>
                                <VisualStateGroup x:Name="PaddingSizeStates">
                                    <VisualState x:Name="DefaultPadding" />
                                    <VisualState x:Name="NarrowPadding" />
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </MenuFlyoutItem.Style>
</MenuFlyoutItem>
